---
link: https://www.notion.so/R23-01-06-1ca184b97c264cd19a833ca632b6a805
notionID: 1ca184b9-7c26-4cd1-9a83-3ca632b6a805
---
#9
##### Polling 혹시 너가 범인이니?
- 아닌 것 같다. 왜?
	1. 당초 의심한 이유
		1. Desk는 남는 코어가 없고, CAT는 남는 코어가 있는 상황
		2. 평균 sys_poll시간이 Desk Random-NOT에서 약 3배가 되지만, CAT에서는 그렇지 않음
	2. 그래서 Desk에서 1코어 남기고 15쓰레드, 살짝 더 큰 파일용량으로해서 메모리 사이즈는 동일하게 맞춘 뒤 성능 측정
	3. CAT에서는 남는 코어들을 전부 off하고 동일하게 성능 측정
	4. 당초 기대한 것은 다음과 같음
		1. Desk에서는 1코어가 남았기 때문에 폴링 시간이 감소하고 LRU-NOT의 random 성능 증가
		2. CAT에서는 남는 코어가 없어졋기 때문에 폴링 시간이 증가하고 LRU-NOT의 random성능 감소
	5. 그러나 실제 결과는 Desk는 여전히 성능이 낮고, CAT는 여전히 성능이 높음

	- 성능이 미쳐 날뛰고 난 뒤에 ftrace를 떠보면 성능이 낮을 때의 sys_poll 평균 시간이 낮다.

#10
##### 결국 데스크탑에서 성능이 미쳐 날뛰기 시작했다.
* 그렇게 판단한 이유와 상황 정리
	1. 15thread, 3.2GB 파일을 만들어서 측정 하다가, nrb-not 커널 새로 빌드해서 실행하다가, 다시 lru-not로 돌아와서 측정하니 15t든 16t든 갑자기 성능이 높게 나옴
	2. 그래서 파일을 다시 다 지우고 다시 만들어서 성능을 측정하니 다시 원래대로 성능이 낮게 나옴
	3. 어쩌면 커널 레이어에서의 상황 차이가 아니라 SSD 내부에서의 상황차이, 즉 디바이스의 성능이 이러한 결과를 만들어 내는 것일까?
* 즉, SSD의 이슈?
	* 일단은 SSD 바꿔서 꽂은 다음에 파일시스템을 SSD친화적인 f2fs로 바꿔서 해보자
	* 남는 SSD가 SAS여서 바꿔 꽂기 실패


#11
##### RAMDISK 시도 가자
- RAMDISK로 하는거니까 일단은 f2fs로 하지 않고 ext4로 계속 한다.

#12
##### I/O Throttling의 정확한 분석도 가자
- 어느 상황에 트리거링 해서
- 얼마만큼씩 자는가?

- 분석 후에 하고싶은건 있잖아 그...  Random같은 상황,  즉 active<->inactive 이동이 많아서 정작 쫓아내서 공간 창출하는데 시간을 많이 못쓰는 상황에 쓰로틀링 좀 더하고, 그렇지 않으면 쓰로틀링 안하고 해서
- Write의 성능을 끌어 올리는 그런 디자인

#13
##### 결국 그래서 지금 뭘 보고 싶은거야?
- NOT를 하면 일단 Lock으로 인해서 kswapd가 느려지고, kswapd가 느려져서 direct reclaim이 발생해서 결과적으로 성능이 느려지는건 맞아
- 그런데 NOT가 LRU에서도 성능이 좋을 때가 있어.
- 즉, lock이 문제인건 맞지만, 잘만 조절하면 lock 고치는거 없이도 성능을 lock 고치는 것과 동일하게 만들 수 있지 않을까? <= 이걸 찾고 싶어